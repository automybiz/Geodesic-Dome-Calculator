<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geodesic Dome DIY Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <center><h2 style="color:#0FF">Geodesic Dome Spec & DIY Plywood-Panel Estimator</h2></center>

    <div class="accordion-container">
        <div class="accordion-header" onclick="toggleAccordion()" id="defaultSettingsHeader">
            <h3>Default Settings</h3>
            <span class="icon">▼</span>
        </div>
        <div class="accordion-content" id="accordionContent">
            <div class="settings-grid">
                <div class="setting-item">
                    <label>Units</label>
                    <select id="unitSelect" onchange="recalcAll()">
                        <option value="mm">millimeter (mm)</option>
                        <option value="cm">centimeter (cm)</option>
                        <option value="m">meter (m)</option>
                        <option value="in">inch (in)</option>
                        <option value="ft" selected>foot (ft)</option>
                    </select>
                </div>
                <div class="setting-item" id="globalSavingsBox">
                    <label>Savings Threshold (%)</label>
                    <input type="number" id="savingsThreshold" value="25" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>1/2" EMT Price</label>
                    <input type="number" id="priceEMT12" value="6.28" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>3/4" EMT Price</label>
                    <input type="number" id="priceEMT34" value="10.48" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>1" EMT Price</label>
                    <input type="number" id="priceEMT1" value="18.34" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>1.25" EMT Price</label>
                    <input type="number" id="priceEMT125" value="24.00" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>Bolts ($/ea)</label>
                    <input type="number" id="priceBolt" value="0.85" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>Nyloc Nuts ($/ea)</label>
                    <input type="number" id="priceNut" value="0.45" step="0.01" onchange="recalcAll()">
                </div>
            </div>

            <div class="panel-manager">
                <div class="setting-item" style="max-width: 500px;">
                    <label>Panel Material</label>
                    <div style="display:flex; gap:10px;">
                        <select id="panelMaterialSelect" onchange="updatePanelCost()" style="flex-grow:1;">
                            <!-- Populated by JS -->
                        </select>
                        <button onclick="editCurrentMaterial()" style="background: #002222; color: #0FF; border: 1px solid #0FF; padding: 5px 10px; cursor: pointer; white-space:nowrap;">Edit</button>
                        <button onclick="openMaterialModal()" style="background: #003333; color: #0FF; border: 1px solid #0FF; padding: 5px 10px; cursor: pointer; white-space:nowrap;">+ Add</button>
                    </div>
                </div>
                <div id="panelCostDisplay" style="margin-top: 10px; color: #AAA; font-size: 0.9em;"></div>
            </div>

            <div class="visibility-controls">
                <h4 style="color:#0FF; margin:0 0 10px 0;">Visible Domes</h4>
                <div id="domeVisibilityGrid" class="visibility-grid">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>
    </div>

    <div id="customTooltip" class="tooltip-box"></div>

    <table id="domeTable">
        <thead>
            <tr>
                <th>Dome Size</th>
                <th>Pacific Domes Frame Price</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_DIY_FREQ">DIY Frequency</th>
                <th>Conduit Tube Size</th>
                <th>Conduit Price ($/ea)</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_DIAGONAL" id="head-diag">The Diagonal (in)</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_STRUT_LEN">Strut Lengths (End to End)</th>
                <th>Total Tubes</th>
                <th>Total Struts</th>
                <th>Total Bolts & Nuts</th>
                <th>Bolts ($/ea)</th>
                <th>Nyloc Nuts ($/ea)</th>
                <th>DIY Frame Price</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_PANEL_COST">Panel Price</th>
                <th>Frame + Panel Price</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Injected by app.js -->
        </tbody>
    </table>

    <br>
    <div class="accordion-container">
        <div class="accordion-header" onclick="toggleAccordion('usageGuideContent')">
            <h3>Usage Guide: Need to Knows</h3>
            <span class="icon">▼</span>
        </div>
        <div id="usageGuideContent" class="accordion-content">
            <div class="guide-step">
                <h4>1. Set Your Global Standards</h4>
                <p>Start at the very top. Select your preferred <strong>Units</strong> (mm, cm, m, in, ft). This instantly updates every measurement in the table. Next, set your <strong>Savings Threshold</strong>. This tells the calculator when to show prices in <span class="price-green">GREEN</span> (Good Deal!) or <span class="price-white">WHITE</span> (Standard). Note: Editable columns have lighter background colors to indicate they are editable.</p>
            </div>
            <br>
            <div class="guide-step">
                <h4>2. Find Your Dome Size</h4>
                <p>Locate the row for the dome size you want to build (e.g., 20' / 6m). We show the <strong>Pacific Domes Price</strong> so you can see how much you're saving by going DIY.</p>
            </div>
            <br>
            <div class="guide-step">
                <h4>3. The "Diagonal" is King</h4>
                <p>This is the most critical step. Enter the maximum width of your panel material into <strong>"The Diagonal"</strong> column. 
                <br><em>Why?</em> Because if you're using 4x4 ft plywood or 5x5 ft tin sheet, your diagonal cannot exceed ~48 or ~60 inches respectively. The calculator uses this number to ensure your panels actually fit on your sheets!</p>
            </div>
            <br>
            <div class="guide-step">
                <h4>4. Watch the Frequency Auto-Adjust</h4>
                <p>Once you enter a Diagonal, watch the <strong>DIY Frequency</strong> column. The calculator will automatically increase the frequency (from 1V to 2V, 3V, etc.) until the panels are small enough to fit within your Diagonal constraint. You don't need to guess the lowest frequency; the calculator finds the lowest one that works for your material.</p>
            </div>
            <br>
            <div class="guide-step">
                <h4>5. Check Strut Lengths</h4>
                <p>Review the <strong>Strut Lengths</strong> column.</p>
                <ul>
                    <li>If a strut length is <span class="price-red">RED</span>, it is too long for your material (The Diagonal).</li>
                    <li>The calculator checks if each strut can physically fit on your panel material. If it's too long, it won't fit!</li>
                    <li><strong>To fix RED struts:</strong> Try increasing the frequency (V) manually or buy larger material and increase "The Diagonal".</li>
                </ul>
            </div>
            <br>
            <div class="guide-step">
                <h4>6. Check Costs & Savings</h4>
                <p>Finally, look at the <strong>DIY Price Minimum</strong>.</p>
                <ul>
                    <li>If the Total Price is <span class="price-green">GREEN</span>, you are meeting your savings goal!</li>
                    <li>If it's <span class="price-white">WHITE</span>, you're still saving money vs Pacific Domes.</li>
                    <li>If it's <span class="price-red">RED</span>, the DIY cost is higher than buying the kit!</li>
                </ul>
            </div>
            <br>
            <div class="guide-step">
                <h4>7. Trouble Seeing? Zoom In!</h4>
                <p>If the text is too small, you can easily adjust the size of the entire calculator.</p>
                <ul>
                    <li><strong>Windows:</strong> Hold <kbd>CTRL</kbd> and scroll your mouse wheel, or press <kbd>CTRL</kbd> + <kbd>+</kbd>.</li>
                    <li><strong>Mac:</strong> Hold <kbd>CMD</kbd> and press <kbd>+</kbd> or <kbd>-</kbd> to zoom in or out.</li>
                </ul>
            </div>
            <br>
            <div class="guide-step">
                <h4>8. Screenshot Your Desired Calculations</h4>
                <p>Once you've found your ideal combo of Frequencies, Diagonals, and Price Ranges, you can take a screenshot using your favorite screenshot app or by pressing the Print Screen button and then pasting into an image editor. If you don't have an image editor, you can use <a href="https://www.photopea.com/" target="_blank" style="color:#0FF;">PhotoPea.com</a> for free.</p>
                
                <p><strong>Best Free Screenshot Apps:</strong></p>
                <ul>
                    <li>Windows Snipping Tool (Built-in)</li>
                    <li>Mac Screenshot (CMD + Shift + 4)</li>
                    <li><a href="https://app.prntscr.com/" target="_blank" style="color:#0FF;">Lightshot</a> (Mac/Win)</li>
                    <li><a href="https://getgreenshot.org/" target="_blank" style="color:#0FF;">Greenshot</a> (Win)</li>
                    <li><a href="https://getsharex.com/" target="_blank" style="color:#0FF;">ShareX</a> (Win)</li>
                </ul>
                
                <p><strong>Best Paid Screenshot Apps:</strong></p>
                <ul>
                    <li><a href="https://www.techsmith.com/screen-capture.html" target="_blank" style="color:#0FF;">Snagit</a> (Mac/Win)</li>
                    <li><a href="https://cleanshot.com/" target="_blank" style="color:#0FF;">CleanShot X</a> (Mac)</li>
                    <li><a href="https://www.ashampoo.com/en-us/snap" target="_blank" style="color:#0FF;">Ashampoo Snap</a> (Win)</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="accordion-container">
        <div class="accordion-header" onclick="toggleAccordion('legendContent')">
            <h3>Column Legend</h3>
            <span class="icon">▼</span>
        </div>
        <div id="legendContent" class="accordion-content">
        <table>
            <thead>
                <tr>
                    <th>Column</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>DIY Frequency</strong></td>
                    <td>The number of times the triangles are subdivided. Higher "v" = smaller panels but more struts.</td>
                </tr>
                <tr>
                    <td><strong>The Diagonal</strong></td>
                    <td>The maximum width of your pentagonal panel cluster. Supports flexible unit input (e.g., 4' 2" or 1250mm).</td>
                </tr>
                <tr>
                    <td><strong>Strut Lengths</strong></td>
                    <td>The end-to-end length of the conduit. (Note: includes a 3/4" / 19.05mm hole-to-end offset).</td>
                </tr>
                <tr>
                    <td><strong>Base Frequency</strong></td>
                    <td>The lowest frequency recommended for structural stability at that dome size.</td>
                </tr>
            </tbody>
        </table>
    </div>
    </div>

    <!-- Material Builder Modal -->
    <div id="materialModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeMaterialModal()">&times;</span>
            <h3 style="color: #0FF; margin-top: 0;">Material Builder</h3>
            
            <div class="modal-form-grid">
                <div class="setting-item full-width">
                    <label>Material Name</label>
                    <input type="text" id="newMatName" placeholder="e.g. 1/2in Plywood">
                </div>

                <div class="setting-item">
                    <label>Type</label>
                    <select id="newMatType" onchange="toggleMatInputs()">
                        <option value="sheet">Sheet (4x8, etc)</option>
                        <option value="roll">Roll (Wrap, etc)</option>
                        <option value="unit">Unit (Yards, etc)</option>
                    </select>
                </div>

                <div class="setting-item">
                    <label>Price ($)</label>
                    <input type="number" id="newMatPrice" placeholder="0.00">
                </div>

                <!-- Dimensions Section -->
                <div class="setting-item" id="dimWidthGroup">
                    <label>Width (ft)</label>
                    <input type="number" id="newMatWidth" placeholder="4">
                </div>

                <div class="setting-item" id="dimLengthGroup">
                    <label>Length (ft)</label>
                    <input type="number" id="newMatLength" placeholder="8">
                </div>

                <div class="setting-item full-width">
                    <label>Waste Factor (%) <span id="wasteVal" style="color:#AAA; font-size:0.8em;">(15%)</span></label>
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <button onclick="autoEstimateWaste('rect')" style="flex:1; background:transparent; border:1px solid #099; color:#0FF; font-size:0.8em; cursor:pointer; padding:4px; border-radius:4px;">1:2 Ratio (Rectangle) (4x8) (5x10)</button>
                        <button onclick="autoEstimateWaste('sq')" style="flex:1; background:transparent; border:1px solid #C55; color:#F99; font-size:0.8em; cursor:pointer; padding:4px; border-radius:4px;">1:1 Ratio (Square) (4x4) (5x5)</button>
                        <span class="help-head" style="cursor:help; color:#FFF; border:1px solid #555; border-radius:50%; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; font-size:0.8em;" data-tooltip-id="TOOLTIP_MAT_EFFICIENCY">?</span>
                    </div>
                    <input type="range" id="newMatWaste" min="0" max="60" value="15" oninput="document.getElementById('wasteVal').innerText = `(${this.value}%)`" style="width:100%">
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-primary" onclick="saveNewMaterial()">Save Material</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
