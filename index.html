<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geodesic Dome DIY Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <center><h2 style="color:#0FF">Geodesic Dome DIY Frame & Panel Calculator</h2></center>

    <div class="accordion-container">
        <div class="accordion-header" onclick="toggleAccordion()" id="defaultSettingsHeader">
            <h3>Default Global Settings</h3>
            <span class="icon">▼</span>
        </div>
        <div class="accordion-content" id="accordionContent">
            <div class="settings-grid">
                <div class="setting-item">
                    <label>Units</label>
                    <select id="unitSelect" onchange="recalcAll()">
                        <option value="mm">millimeter (mm)</option>
                        <option value="cm">centimeter (cm)</option>
                        <option value="m">meter (m)</option>
                        <option value="in">inch (in)</option>
                        <option value="ft" selected>foot (ft)</option>
                    </select>
                </div>
                <div class="setting-item" id="globalSavingsBox">
                    <label>Savings Threshold (%)</label>
                    <input type="number" id="savingsThreshold" value="25" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>1/2" EMT Price</label>
                    <input type="number" id="priceEMT12" value="6.28" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>3/4" EMT Price</label>
                    <input type="number" id="priceEMT34" value="10.48" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>1" EMT Price</label>
                    <input type="number" id="priceEMT1" value="18.34" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>1.25" EMT Price</label>
                    <input type="number" id="priceEMT125" value="24.00" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>Bolts ($/ea)</label>
                    <input type="number" id="priceBolt" value="0.85" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>Nyloc Nuts ($/ea)</label>
                    <input type="number" id="priceNut" value="0.45" step="0.01" onchange="recalcAll()">
                </div>
                <div class="setting-item">
                    <label>Strut Sorting</label>
                    <select id="strutSortSelect" onchange="recalcAll()">
                        <option value="length">Shortest to Longest</option>
                        <option value="alpha">Alphabetical (A-Z)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>Optimize Frequency <span class="help-head" style="cursor:help; color:#FFF; border:1px solid #555; border-radius:50%; width:16px; height:16px; display:inline-flex; align-items:center; justify-content:center; font-size:0.7em;" data-tooltip-id="TOOLTIP_DEFAULT_FREQ_OPTIMIZE">?</span></label>
                    <select id="freqOptimizeSelect" onchange="recalcAll()">
                        <option value="freq">Lowest Frequency (Complexity)</option>
                        <option value="price">Lowest Price (Budget)</option>
                    </select>
                </div>
                <div class="setting-item" style="flex-direction: row; align-items: center; gap: 10px;">
                    <label for="showDiagonalToggle" style="margin-bottom: 0;">Show "The Diagonal" Column</label>
                    <input type="checkbox" id="showDiagonalToggle" checked onchange="toggleDiagonalColumn()">
                    <span class="help-head" style="cursor:help; color:#FFF; border:1px solid #555; border-radius:50%; width:16px; height:16px; display:inline-flex; align-items:center; justify-content:center; font-size:0.7em;" data-tooltip-id="TOOLTIP_DEFAULT_DIAGONAL">?</span>
                </div>
            </div>

            <div class="panel-manager">
                <div class="setting-item" style="max-width: 500px;">
                    <label>Panel Material</label>
                    <div style="display:flex; gap:10px;">
                        <select id="panelMaterialSelect" onchange="updatePanelCost()" style="flex-grow:1;">
                            <!-- Populated by JS -->
                        </select>
                        <button onclick="editCurrentMaterial()" style="background: #002222; color: #0FF; border: 1px solid #0FF; padding: 5px 10px; cursor: pointer; white-space:nowrap;">Edit</button>
                        <button onclick="openMaterialModal()" style="background: #003333; color: #0FF; border: 1px solid #0FF; padding: 5px 10px; cursor: pointer; white-space:nowrap;">+ Add</button>
                    </div>
                </div>
                <div id="panelCostDisplay" style="margin-top: 10px; color: #AAA; font-size: 0.9em;"></div>
            </div>

            <div class="visibility-controls">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="color:#0FF; margin:0;">Visible Domes</h4>
                    <button onclick="showOnlyPD()" style="background: transparent; color: #0FF; border: 1px solid #0FF; padding: 2px 8px; cursor: pointer; font-size: 0.8em; border-radius: 4px;">Show Only Pacific Domes Sizes</button>
                </div>
                <div id="domeVisibilityGrid" class="visibility-grid">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>
    </div>

    <div id="customTooltip" class="tooltip-box"></div>
    <div id="customVisualizer" class="visualizer-tooltip"></div>

    <table id="domeTable">
        <thead>
            <tr>
                <th>Dome Size</th>
                <th>Pacific Domes <br> Frame Price</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_COLUMN_DIY_FREQ">DIY <br> Frequency</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_COLUMN_CONDUIT_SAFETY">Conduit <br> Tube Size</th>
                <th>Conduit Price <br> ($/ea)</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_COLUMN_DIAGONAL" id="head-diag">The Diagonal <br> (in)</th>
                <th id="head-sheet">Sheet Width <br> (ft)</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_COLUMN_STRUT_LEN">Strut Lengths <br> (End to End)</th>
                <th>Total Conduit <br> Tubes</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_COLUMN_TOTAL_STRUTS">Total Struts</th>
                <th>Total Bolts <br>& Nuts</th>
                <th>Bolts <br> ($/ea)</th>
                <th>Nyloc Nuts <br> ($/ea)</th>
                <th>DIY Frame <br> Price</th>
                <th class="help-head" data-tooltip-id="TOOLTIP_COLUMN_PANEL_COST">Panel Price</th>
                <th>Frame + Panel <br> Price</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Injected by app.js -->
        </tbody>
    </table>

    <br>
    <div class="accordion-container">
        <div class="accordion-header" onclick="toggleAccordion('usageGuideContent')">
            <h3>Usage Guide: Need to Knows</h3>
            <span class="icon">▼</span>
        </div>
        <div id="usageGuideContent" class="accordion-content">
            <div class="guide-step">
                <h4>1. Configure Global Build Standards</h4>
                <p>Start with the <strong>Default Global Settings</strong> at the top. 
                <ul>
                    <li><strong>Units:</strong> Choose between Metric and Imperial. Everything in the table updates instantly.</li>
                    <li><strong>Savings Threshold:</strong> Set the percentage you want to save vs retail prices. This affects the <span class="price-green">GREEN</span> highlighting in the Frame Price column.</li>
                    <li><strong>Local Pricing:</strong> Enter the price of EMT conduit and hardware at your local hardware store to get an accurate budget estimate.</li>
                </ul>
            </p>
            </div>
            <br>
            <div class="guide-step">
                <h4>2. Select Your Dome Size</h4>
                <p>Find the row matching your desired dome diameter (e.g., 20' / 6m). We include the <strong>Pacific Domes retail price</strong> as a reference so you can track your DIY savings in real-time. 
                <br><em>Note: All columns to the right of the retail price are specific to your custom DIY configuration.</em></p>
            </div>
            <br>
            <div class="guide-step">
                <h4>3. Input Your Material Width (Sheet Width)</h4>
                <p>This is the most important DIY constraint. Enter the width of the material you'll be using for panels (e.g., 4ft for standard plywood). 
                <br>The calculator uses this to ensure your struts are short enough that the resulting triangular panels will physically fit on your material sheets.</p>
            </div>
            <br>
            <div class="guide-step">
                <h4>4. Optimize DIY Frequency (V)</h4>
                <p>The <strong>DIY Frequency</strong> column tells you how complex the dome is. 
                <ul>
                    <li><strong>Auto-Adjustment:</strong> By default, the calculator automatically increases the frequency until your panels fit on the <strong>Sheet Width</strong> you provided.</li>
                    <li><strong>Visual Feedback:</strong> If any <strong>Strut Lengths</strong> are <span class="price-red">RED</span>, they are too long for your material. Simply increase the Frequency (e.g., from 3V to 4V) to shorten the struts until the red disappears.</li>
                </ul>
            </p>
            </div>
            <br>
            <div class="guide-step">
                <h4>5. Verify Conduit Safety Sizing</h4>
                <p>The <strong>Conduit Tube Size</strong> dropdown will turn <span class="price-red">RED</span> if the selected tubing is too thin for the length of your struts. 
                <ul>
                    <li>The calculator follows structural engineering standards to prevent strut buckling.</li>
                    <li>On initial load, it automatically picks the <strong>smallest safe size</strong>. If you manually downsize to an unsafe diameter, the red warning will appear.</li>
                </ul>
            </p>
            </div>
            <br>
            <div class="guide-step">
                <h4>6. Review Costs & Budget</h4>
                <p>Look at the <strong>DIY Frame Price</strong> and <strong>Frame + Panel Price</strong> columns to see your totals.
                <ul>
                    <li><span class="price-green">GREEN:</span> You are saving more than your defined Savings Threshold!</li>
                    <li><span class="price-white">WHITE:</span> You are saving money, but haven't hit your threshold yet.</li>
                    <li><span class="price-red">RED:</span> Your DIY build is currently more expensive than buying a pre-made kit.</li>
                </ul>
            </p>
            </div>
            <br>
            <div class="guide-step">
                <h4>7. Accessibility: Zoom for Detail</h4>
                <p>If the text is too small, you can easily adjust the size of the entire calculator.</p>
                <ul>
                    <li><strong>Windows:</strong> Hold <kbd>CTRL</kbd> and scroll your mouse wheel, or press <kbd>CTRL</kbd> + <kbd>+</kbd>.</li>
                    <li><strong>Mac:</strong> Hold <kbd>CMD</kbd> and press <kbd>+</kbd> or <kbd>-</kbd> to zoom in or out.</li>
                </ul>
            </div>
            <br>
            <div class="guide-step">
                <h4>8. Screenshot Your Desired Calculations</h4>
                <p>Once you've found your ideal combo of Frequencies, Diagonals, and Price Ranges, you can take a screenshot using your favorite screenshot app or by pressing the Print Screen button and then pasting into an image editor. If you don't have an image editor, you can use <a href="https://www.photopea.com/" target="_blank" style="color:#0FF;">PhotoPea.com</a> for free.</p>
                
                <p><strong>Best Free Screenshot Apps:</strong></p>
                <ul>
                    <li>Windows Snipping Tool (Built-in)</li>
                    <li>Mac Screenshot (CMD + Shift + 4)</li>
                    <li><a href="https://app.prntscr.com/" target="_blank" style="color:#0FF;">Lightshot</a> (Mac/Win)</li>
                    <li><a href="https://getgreenshot.org/" target="_blank" style="color:#0FF;">Greenshot</a> (Win)</li>
                    <li><a href="https://getsharex.com/" target="_blank" style="color:#0FF;">ShareX</a> (Win)</li>
                </ul>
                
                <p><strong>Best Paid Screenshot Apps:</strong></p>
                <ul>
                    <li><a href="https://www.techsmith.com/screen-capture.html" target="_blank" style="color:#0FF;">Snagit</a> (Mac/Win)</li>
                    <li><a href="https://cleanshot.com/" target="_blank" style="color:#0FF;">CleanShot X</a> (Mac)</li>
                    <li><a href="https://www.ashampoo.com/en-us/snap" target="_blank" style="color:#0FF;">Ashampoo Snap</a> (Win)</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="accordion-container">
        <div class="accordion-header" onclick="toggleAccordion('safetyThresholdsContent')">
            <h3>Safety Thresholds & Engineering References</h3>
            <span class="icon">▼</span>
        </div>
        <div id="safetyThresholdsContent" class="accordion-content">
            <p>The safety thresholds used in this calculator are based on a combination of engineering principles and long-standing community standards within the DIY geodesic dome building community.</p>

            <h4>1. Desert Domes (The DIY Gold Standard)</h4>
            <p>One of the oldest and most respected resources for DIY geodesic builds. Their "Conduit Dome" guides recommend <strong>1/2" EMT</strong> for smaller 2V/3V domes (struts usually under 5ft) and suggest stepping up to <strong>3/4" or 1"</strong> as the dome diameter increases past 16-20 feet.
            <br>Source: <a href="http://www.desertdomes.com" target="_blank" style="color:#0FF;">DesertDomes.com</a></p>

            <h4>2. DomesWorld / Paul Robinson</h4>
            <p>Paul Robinson documented extensive testing on EMT structural limits. His data suggests that resistance to buckling drops off sharply once a strut exceeds roughly <strong>5 feet (1.5 meters)</strong>, which informs our safety flagging.
            <br>Source: <a href="http://www.domesworld.com" target="_blank" style="color:#0FF;">DomesWorld.com / DIY Geodesic Dome Construction</a></p>

            <h4>3. Engineering Principles: Slenderness Ratio</h4>
            <p>Modern engineering analysis of designs using EMT conduit relies on the <strong>Slenderness Ratio</strong> (Length / Radius of Gyration). For steel tubing, keeping this ratio low prevents catastrophic elastic buckling.
            <br>
            <strong>Thresholds:</strong>
            <ul>
                <li><strong>1/2" EMT (OD 0.706"):</strong> Buckling risk increases significantly at ~60 inches (5ft).</li>
                <li><strong>3/4" EMT (OD 0.922"):</strong> Safe threshold extends to ~84 inches (7ft).</li>
                <li><strong>1" EMT (OD 1.163"):</strong> Safe threshold extends to ~120 inches (10ft).</li>
            </ul>
            Source: <a href="https://www.aisc.org/" target="_blank" style="color:#0FF;">AISC Manual of Steel Construction</a> applied to EMT specifications.</p>

            <h4>4. Burning Man Project / "Black Rock City" Build Guides</h4>
            <p>Community-maintained guides based on real-world high-wind performance. They recommend <strong>3/4" EMT</strong> as the minimum if struts exceed 5 feet, and <strong>1" EMT</strong> for 24'+ domes to ensure the frame doesn't kink under wind or structural loads.
            <br>Source: <a href="https://hive.burningman.org" target="_blank" style="color:#0FF;">Burning Man Hive / Dome Building Resources</a></p>
        </div>
    </div>

    <!-- Material Builder Modal -->
    <div id="materialModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close-modal" onclick="closeMaterialModal()">&times;</span>
            <h3 style="color: #0FF; margin-top: 0;">Material Builder</h3>
            
            <div style="display: flex; gap: 20px; align-items: start;">
            <div class="modal-form-grid" style="flex: 1;">
                <div class="setting-item full-width">
                    <label>Material Name</label>
                    <input type="text" id="newMatName" placeholder="e.g. 1/2in Plywood">
                </div>

                <div class="setting-item">
                    <label>Type</label>
                    <select id="newMatType" onchange="toggleMatInputs()">
                        <option value="sheet">Sheet (4x8, etc)</option>
                        <option value="roll">Roll (Wrap, etc)</option>
                        <option value="unit">Unit (Yards, etc)</option>
                    </select>
                </div>

                <div class="setting-item">
                    <label>Price ($)</label>
                    <input type="number" id="newMatPrice" placeholder="0.00">
                </div>

                <!-- Dimensions Section -->
                <div class="setting-item" id="dimWidthGroup">
                    <label>Width (ft)</label>
                    <input type="number" id="newMatWidth" placeholder="4">
                </div>

                <div class="setting-item" id="dimLengthGroup">
                    <label>Length (ft)</label>
                    <input type="number" id="newMatLength" placeholder="8">
                </div>

                <div class="setting-item full-width">
                    <label>Waste Factor (%) <span id="wasteVal" style="color:#AAA; font-size:0.8em;">(15%)</span></label>
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <button onclick="autoEstimateWaste()" style="flex:1; background:transparent; border:1px solid #099; color:#0FF; font-size:0.8em; cursor:pointer; padding:4px; border-radius:4px;">Auto-Calculate Waste (Honeycomb Nesting)</button>
                        <span class="help-head" style="cursor:help; color:#FFF; border:1px solid #555; border-radius:50%; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; font-size:0.8em;" data-tooltip-id="TOOLTIP_DEFAULT_MAT_EFFICIENCY">?</span>
                    </div>
                    <input type="range" id="newMatWaste" min="0" max="60" value="15" oninput="document.getElementById('wasteVal').innerText = `(${this.value}%)`" style="width:100%">
                </div>
            </div>

            <div id="modalVisualizer" style="flex: 1; border: 1px solid #333; background: #050505; min-height: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border-radius: 8px;">
                <h4 style="margin: 0 0 10px 0; color: #AAA; font-size: 0.8em;">Material Preview</h4>
                <div id="modalSvgContainer"></div>
            </div>
            </div>

            <div class="modal-footer">
                <button class="btn-primary" onclick="saveNewMaterial()">Save Material</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
